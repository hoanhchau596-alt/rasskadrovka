<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å–∫–∞–¥—Ä–æ–≤–∫–∞ ‚Äî Wedding Awards South</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@500;600&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #2c2c24;
            --bg-card: #3d3d32;
            --bg-input: #4a4a3e;
            --bg-light: #d4cfc4;
            --accent: #c45a32;
            --accent-hover: #d4693f;
            --text-light: #f5f3ef;
            --text-dim: #a8a498;
            --text-dark: #2c2c24;
            --border: #5a5a4e;
        }

        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ ‚Äî –º–æ–ª–æ—á–Ω—ã–µ/–∫—Ä–µ–º–æ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ */
        [data-theme="light"] {
            --bg-main: #f8f5f0;
            --bg-card: #fffbf5;
            --bg-input: #f0ebe3;
            --bg-light: #e8e2d8;
            --accent: #c45a32;
            --accent-hover: #d4693f;
            --text-light: #3a3632;
            --text-dim: #6b6560;
            --text-dark: #2c2c24;
            --border: #d4cfc4;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
        .theme-toggle {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            border-color: var(--accent);
        }

        .theme-toggle-text {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-dim);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-main);
            color: var(--text-light);
            line-height: 1.6;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 60px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: sticky;
            top: 0;
            background: var(--bg-main);
            z-index: 100;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-light);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-input);
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        /* Hero Section */
        .hero {
            padding: 40px;
            max-width: 1400px;
            margin: 32px auto;
            margin-left: 60px;
            margin-right: 60px;
            max-width: calc(100% - 120px);
            background: var(--bg-card);
            border: 3px solid var(--border);
            border-radius: 16px;
        }

        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 48px;
            font-weight: 500;
            line-height: 1.15;
            margin-bottom: 16px;
        }

        .hero h1 span {
            text-decoration: underline;
            text-decoration-color: var(--accent);
            text-underline-offset: 4px;
        }

        .project-title-input {
            font-family: 'Playfair Display', serif;
            font-size: clamp(28px, 5vw, 56px);
            font-weight: 500;
            background: transparent;
            border: none;
            color: var(--text-light);
            width: 100%;
            outline: none;
            border-bottom: 2px solid transparent;
            transition: border-color 0.2s;
            resize: none;
            overflow: hidden;
            line-height: 1.2;
            min-height: 1.2em;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .project-title-input:focus {
            border-bottom-color: var(--accent);
        }

        .hero-meta {
            display: flex;
            gap: 40px;
            font-size: 18px;
            color: var(--text-dim);
            margin-top: 28px;
            align-items: center;
        }

        .hero-meta div {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dot {
            width: 10px;
            height: 10px;
            background: var(--accent);
            border-radius: 50%;
        }

        .duration-edit-input {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 12px;
            color: var(--text-light);
            font-size: 18px;
            font-family: inherit;
            width: 80px;
            text-align: center;
        }

        .duration-edit-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Characters Section */
        .characters-section {
            margin-top: 32px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
        }

        .characters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dim);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .characters-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .character-item {
            display: grid;
            grid-template-columns: 80px 150px 1fr 40px;
            gap: 12px;
            align-items: start;
            padding: 12px;
            background: var(--bg-input);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .character-item input,
        .character-item textarea {
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 10px;
            color: var(--text-light);
            font-size: 13px;
            font-family: inherit;
        }

        .character-item input:focus,
        .character-item textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .character-item textarea {
            min-height: 60px;
            resize: vertical;
        }

        .character-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--accent);
            padding: 8px 0;
        }

        .character-remove {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .character-remove:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .characters-empty {
            color: var(--text-dim);
            font-size: 13px;
            font-style: italic;
            padding: 12px;
            text-align: center;
        }

        /* Characters in Scene */
        .characters-in-scene .characters-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .character-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .character-checkbox:hover {
            border-color: var(--accent);
        }

        .character-checkbox input {
            accent-color: var(--accent);
        }

        .character-checkbox input:checked+span {
            color: var(--accent);
            font-weight: 500;
        }

        .no-characters {
            color: var(--text-dim);
            font-size: 12px;
            font-style: italic;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 60px 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
        }

        /* Scenes Container */
        .scenes {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 60px 80px;
        }

        /* Scene Card - NEW LAYOUT */
        .scene {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 32px;
            padding: 32px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 3px solid var(--border);
            transition: border-color 0.2s;
        }

        .scene:hover {
            border-color: var(--accent);
        }

        /* –®–∞–ø–∫–∞: –±–µ–π–¥–∂ | –Ω–∞–∑–≤–∞–Ω–∏–µ | –º–µ—Ç–∞ | –∫–Ω–æ–ø–∫–∏ */
        .scene-header-row {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .scene-badge {
            background: var(--accent);
            color: white;
            font-size: 16px;
            font-weight: 700;
            padding: 8px 18px;
            border-radius: 8px;
            flex-shrink: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .scene-title-input {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            font-weight: 500;
            background: transparent;
            border: none;
            color: var(--text-light);
            flex: 1;
            min-width: 200px;
            outline: none;
            padding: 4px 0;
            border-bottom: 1px solid transparent;
        }

        .scene-title-input:focus {
            border-bottom-color: var(--accent);
        }

        .scene-meta-inline {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .meta-field {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meta-field label {
            font-size: 14px;
        }

        .meta-field input,
        .meta-field select {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 10px;
            color: var(--text-light);
            font-size: 13px;
        }

        .duration-input {
            width: 60px;
        }

        .characters-inline {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .characters-checkboxes {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .character-checkbox {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--text-dim);
            cursor: pointer;
        }

        .character-checkbox input {
            width: 14px;
            height: 14px;
        }

        .no-characters {
            font-size: 11px;
            color: var(--text-dim);
        }

        .scene-actions {
            display: flex;
            gap: 6px;
            margin-left: auto;
        }

        .scene-btn {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .scene-btn:hover {
            border-color: var(--accent);
        }

        /* –°–µ—Ä–µ–¥–∏–Ω–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ 75% + –æ–ø–∏—Å–∞–Ω–∏–µ 25% */
        .scene-middle-row {
            display: flex;
            gap: 20px;
        }

        .scene-image-container {
            flex: 0 0 60%;
            position: relative;
        }

        .scene-image-dropzone {
            aspect-ratio: 16/9;
            background: var(--bg-main);
            border: 2px dashed var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .scene-image-dropzone:hover {
            border-color: var(--accent);
        }

        .scene-image-dropzone.has-image {
            border: none;
        }

        .dropzone-content {
            text-align: center;
            color: var(--text-dim);
        }

        .dropzone-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .scene-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .remove-image {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(196, 90, 50, 0.9);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .scene-image-dropzone:hover .remove-image {
            display: flex;
        }

        .scene-description-side {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
        }

        .scene-description-side .description-input {
            flex: 1;
            min-height: 120px;
            background: var(--bg-input);
            color: var(--text-light);
            font-size: 16px;
        }

        /* –ù–∏–∑: –¥–∏–∞–ª–æ–≥ + –∑–∞–º–µ—Ç–∫–∏ */
        .scene-bottom-row {
            display: flex;
            gap: 20px;
        }

        .field-dialogue {
            flex: 2;
        }

        .field-notes {
            flex: 1;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .field-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-dim);
        }

        .field textarea {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-light);
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            line-height: 1.5;
        }

        .field textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .field textarea.dialogue {
            background: var(--bg-main);
            border-left: 4px solid var(--accent);
            font-style: italic;
            min-height: 160px;
            font-size: 18px;
            padding: 16px;
        }

        /* Auto-expand textareas */
        .field textarea {
            overflow: hidden;
            resize: none;
        }

        /* AI Prompt Field */
        .prompt-field {
            margin-top: 8px;
            padding-top: 12px;
            border-top: 1px dashed var(--border);
        }

        .prompt-field .field-label {
            font-size: 10px;
            color: #7a7a6e;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .prompt-field .field-label::before {
            content: 'ü§ñ';
        }

        .prompt-field textarea {
            font-size: 11px;
            min-height: 50px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px dashed var(--border);
            color: #8a8a7e;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .prompt-field textarea:focus {
            color: var(--text-light);
            border-color: var(--accent);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 1000px) {
            .header {
                padding: 16px 24px;
            }

            .hero {
                padding: 40px 24px;
            }

            .toolbar {
                padding: 0 24px 16px;
            }

            .scenes {
                padding: 0 24px 40px;
            }

            .scene {
                grid-template-columns: 1fr;
                padding: 20px;
            }
        }

        /* Hidden file input */
        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="logo">üé¨ Storyboard</div>
        <div class="header-actions">
            <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <span class="theme-icon">üåô</span>
                <span class="theme-toggle-text">–¢—ë–º–Ω–∞—è</span>
            </button>
            <button class="btn btn-secondary" id="resetDefault" title="–°–±—Ä–æ—Å–∏—Ç—å –∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º —Å—Ü–µ–Ω–∞–º">üîÑ –°–±—Ä–æ—Å</button>
            <button class="btn btn-secondary" id="loadProject">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <button class="btn btn-secondary" id="saveProject">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn btn-primary" id="exportHTML">üìÑ –≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="btn btn-primary" id="printVersion">üìÑ PDF</button>
        </div>
    </header>

    <section class="hero">
        <textarea class="project-title-input" id="projectTitle" rows="1"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞...">–ó–∞—è–≤–∫–∞ –Ω–∞ Wedding Awards South</textarea>
        <div class="hero-meta">
            <div><span class="dot"></span> <span id="sceneCount">0</span> —Å—Ü–µ–Ω</div>
            <div><span class="dot"></span> <input type="text" class="duration-edit-input" id="totalDuration"
                    value="0:00" placeholder="0:00"> —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂</div>
            <div><span class="dot"></span> –°—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–∞–¥—Ä—ã</div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ì–µ—Ä–æ–∏ -->
        <div class="characters-section">
            <div class="characters-header">
                <span class="section-label">üë§ –ì–µ—Ä–æ–∏</span>
                <button class="btn btn-small" id="addCharacter">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div class="characters-list" id="charactersList"></div>
        </div>
    </section>

    <div class="toolbar">
        <div class="section-title">–°—Ü–µ–Ω—ã</div>
        <button class="btn btn-primary" id="addScene">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ü–µ–Ω—É</button>
    </div>

    <main class="scenes" id="scenesContainer"></main>

    <div class="toast" id="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>

    <input type="file" id="loadProjectInput" accept=".json" class="hidden">

    <script>
        let scenes = [];
        let characters = [];

        const scenesContainer = document.getElementById('scenesContainer');
        const projectTitleEl = document.getElementById('projectTitle');
        const sceneCountEl = document.getElementById('sceneCount');
        const totalDurationEl = document.getElementById('totalDuration');
        const charactersListEl = document.getElementById('charactersList');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadFromLocalStorage();
            if (scenes.length === 0) {
                loadDefaultScenes();
            }
            renderAllScenes();
            renderCharacters();
        });

        // ===== THEME FUNCTIONS =====
        function loadTheme() {
            const savedTheme = localStorage.getItem('storyboard_theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('storyboard_theme', newTheme);
            updateThemeButton(newTheme);
        }

        function updateThemeButton(theme) {
            const icon = document.querySelector('.theme-icon');
            const text = document.querySelector('.theme-toggle-text');
            if (theme === 'light') {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = '–°–≤–µ—Ç–ª–∞—è';
            } else {
                icon.textContent = 'üåô';
                text.textContent = '–¢—ë–º–Ω–∞—è';
            }
        }

        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // Event Listeners
        document.getElementById('addScene').addEventListener('click', addScene);
        document.getElementById('addCharacter').addEventListener('click', addCharacter);
        document.getElementById('saveProject').addEventListener('click', saveProject);
        document.getElementById('loadProject').addEventListener('click', () => document.getElementById('loadProjectInput').click());
        document.getElementById('loadProjectInput').addEventListener('change', loadProject);
        document.getElementById('exportHTML').addEventListener('click', exportHTML);
        document.getElementById('printVersion').addEventListener('click', printVersion);
        document.getElementById('resetDefault').addEventListener('click', () => {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω—ã –∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º? –¢–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!')) {
                localStorage.removeItem('storyboard_v2');
                loadDefaultScenes();
                characters = [];
                renderCharacters();
                renderAllScenes();
                showToast('–°–±—Ä–æ—à–µ–Ω–æ –∫ –¥–µ—Ñ–æ–ª—Ç—É');
            }
        });
        projectTitleEl.addEventListener('input', saveToLocalStorage);
        projectTitleEl.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞
        setTimeout(() => {
            projectTitleEl.style.height = 'auto';
            projectTitleEl.style.height = projectTitleEl.scrollHeight + 'px';
        }, 100);

        // ===== CHARACTERS FUNCTIONS =====

        function addCharacter() {
            const character = {
                id: Date.now(),
                name: '',
                description: ''
            };
            characters.push(character);
            renderCharacters();
            renderAllScenes(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ü–µ–Ω—ã –¥–ª—è –Ω–æ–≤—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
            saveToLocalStorage();
            showToast('–ì–µ—Ä–æ–π –¥–æ–±–∞–≤–ª–µ–Ω');
        }

        function removeCharacter(id) {
            characters = characters.filter(c => c.id !== id);
            renderCharacters();
            renderAllScenes(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ü–µ–Ω—ã
            saveToLocalStorage();
            showToast('–ì–µ—Ä–æ–π —É–¥–∞–ª—ë–Ω');
        }

        function renderCharacters() {
            if (characters.length === 0) {
                charactersListEl.innerHTML = '<div class="characters-empty">–î–æ–±–∞–≤—å—Ç–µ –≥–µ—Ä–æ–µ–≤ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</div>';
                return;
            }

            charactersListEl.innerHTML = '';
            characters.forEach((char, index) => {
                const item = document.createElement('div');
                item.className = 'character-item';
                item.innerHTML = `
                    <div class="character-label">–ì–µ—Ä–æ–π ${index + 1}</div>
                    <input type="text" class="char-name" value="${char.name}" placeholder="–ò–º—è...">
                    <textarea class="char-description" placeholder="–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: –∫–æ—Å—Ç—é–º, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã, –≤–Ω–µ—à–Ω–æ—Å—Ç—å...">${char.description}</textarea>
                    <button class="character-remove" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                `;

                item.querySelector('.char-name').addEventListener('input', (e) => {
                    char.name = e.target.value;
                    saveToLocalStorage();
                });

                item.querySelector('.char-description').addEventListener('input', (e) => {
                    char.description = e.target.value;
                    saveToLocalStorage();
                });

                item.querySelector('.character-remove').addEventListener('click', () => removeCharacter(char.id));

                charactersListEl.appendChild(item);
            });
        }

        // Default scenes
        function loadDefaultScenes() {
            scenes = [
                { id: 1, title: "–†–µ–ª—å—Å—ã –≤–¥–∞–ª—å", description: "–°—Ç–∞—Ç–∏—á–Ω—ã–π –∫–∞–¥—Ä: —Ä–µ–ª—å—Å—ã —É—Ö–æ–¥—è—Ç –≤–¥–∞–ª—å, –∫–∞–º–µ—Ä–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–µ–º–ª–∏. –°—Ç–µ–ø—å, –±–µ–∑—ã—Å—Ö–æ–¥–Ω–æ—Å—Ç—å.", dialogue: "¬´–ì–¥–µ-—Ç–æ —Ç–∞–∫ –¥–∞–ª–µ–∫–æ –ø–æ–¥ –í–æ–ª–≥–æ–≥—Ä–∞–¥–æ–º, —á—Ç–æ –Ω–µ –∑–Ω–∞—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ –í–ï–î–î–ò–ù–ì –≠–í–û–†–î–° –°–æ—É—Ç...", duration: "0:05", shotType: "wide", notes: "–ì–æ–ª–æ—Å –∑–∞ –∫–∞–¥—Ä–æ–º. –ù–∏–∑–∫–∏–π —Ä–∞–∫—É—Ä—Å.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, wide shot, abandoned railway tracks stretching into distance, perspective from ground level, bare winter trees on sides, Russian steppe, desolate atmosphere, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 2, title: "–ñ–µ–Ω—è –Ω–∞ —Ä–µ–ª—å—Å–∞—Ö —Å –∫–ª—è–ø–æ–º", description: "–ì–µ—Ä–æ–π 1 (–ñ–µ–Ω—è) –ª–µ–∂–∏—Ç –Ω–∞ —Ä–µ–ª—å—Å–∞—Ö —Å–≤—è–∑–∞–Ω–Ω—ã–π, –≤–∏–¥–Ω–æ —Ä–µ–ª—å—Å—ã –∏ –≥–µ—Ä–æ—è –ø–æ –ø–æ—è—Å. –ü–ª–∞—Ç–æ–∫ –Ω–∞ —à–µ–µ, –∫–ª—è–ø –≤–æ —Ä—Ç—É. –ü—ã—Ç–∞–µ—Ç—Å—è –≤—ã–ø–ª—é–Ω—É—Ç—å ‚Äî –ø–æ–ª—É—á–∞–µ—Ç—Å—è.", dialogue: "...–Ω–æ –∏ –ø—Ä–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫‚Ä¶¬ª", duration: "0:05", shotType: "medium", notes: "–ì–æ–ª–æ—Å –∑–∞ –∫–∞–¥—Ä–æ–º. –ö–ª—è–ø –≤—ã–ø–ª—ë–≤—ã–≤–∞–µ—Ç—Å—è.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, young man lying tied on railway tracks, gag in mouth trying to spit it out, scarf around neck, ropes binding arms, waist up visible, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 3, title: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Äî –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω", description: "–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –ñ–µ–Ω–∏ —É–∂–µ –±–µ–∑ –∫–ª—è–ø–∞. –°–º–æ—Ç—Ä–∏—Ç –≤ –∫–∞–º–µ—Ä—É.", dialogue: "–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ñ–µ–Ω—è –ö–∞—à–∞—Ä–Ω—ã–π, –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ —è –ø–æ–Ω–∏–º–∞—é —É –º–µ–Ω—è –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ù–µ –±–æ–ª–µ–µ —Ç—Ä—ë—Ö –º–∏–Ω—É—Ç‚Ä¶", duration: "0:08", shotType: "close", notes: "–ú–∏–º–∏–∫–∞ ‚Äî –ª—ë–≥–∫–∞—è –ø–∞–Ω–∏–∫–∞ —Å —é–º–æ—Ä–æ–º.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, young man face looking at camera, lying on ground, no gag, slightly worried but humorous expression, scarf visible, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 4, title: "–ü–æ–µ–∑–¥ –≤–¥–∞–ª–µ–∫–µ", description: "–í–¥–∞–ª–µ–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–µ–∑–¥ ‚Äî —Ç–æ—á–∫–∞ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ.", dialogue: "–í–∏–∂—É –≤ –≤–∞—à–∏—Ö –≥–ª–∞–∑–∞—Ö –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–≥–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:", duration: "0:03", shotType: "wide", notes: "–ì–æ–ª–æ—Å –ñ–µ–Ω–∏ –∑–∞ –∫–∞–¥—Ä–æ–º. –î–∞–ª—ë–∫–∏–π –≥—É–¥–æ–∫.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, wide shot, distant steam train on horizon, small silhouette approaching on railway tracks, perspective down rails, bare trees, ominous atmosphere, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 5, title: "–ñ–µ–Ω—è ‚Äî —Å—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω", description: "–ñ–µ–Ω—è, –∫–∞–¥—Ä –ø–æ –ø–æ—è—Å. –í–∏–¥–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä—É–∫–∏ –∏ —Å—Ç—Ä–∞–Ω–Ω—ã–π –ø–ª–∞—Ç–æ–∫ –Ω–∞ —à–µ–µ.", dialogue: "¬´–ü–æ—á–µ–º—É —è —Å–≤—è–∑–∞–Ω, –ª–µ–∂—É –Ω–∞ —Ä–µ–ª—å—Å–∞—Ö –∏ —É –º–µ–Ω—è –Ω–∞ —à–µ–µ —ç—Ç–æ—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–π –ø–ª–∞—Ç–æ–∫?¬ª –í–æ-–ø–µ—Ä–≤—ã—Ö, –Ω–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —è –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–æ —Ä–µ–ª—å—Å—ã.", duration: "0:08", shotType: "medium", notes: "–ñ–µ—Å—Ç–∏–∫—É–ª–∏—Ä—É–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Ä—É–∫–∞–º–∏.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, young man lying on railway tracks, waist up visible, bound hands gesturing, scarf around neck, talking to camera, bare trees background, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 6, title: "–ñ–µ–Ω—è ‚Äî –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –ª–∏—Ü–∞", description: "–£–∫—Ä—É–ø–Ω—è–µ–º—Å—è –Ω–∞ –≥–µ—Ä–æ—è. –ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω ‚Äî —Ç–æ–ª—å–∫–æ –ª–∏—Ü–æ –≤ –∫–∞–¥—Ä–µ.", dialogue: "–ê –≤–æ-–≤—Ç–æ—Ä—ã—Ö, —ç—Ç–æ –º–æ—è –ø–µ—Ä–≤–∞—è –∑–∞—è–≤–∫–∞ –∏ —è –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é, —á–µ–º –º–æ–≥—É –≤–∞—Å —É–¥–∏–≤–∏—Ç—å.", duration: "0:05", shotType: "close", notes: "–ß–µ—Å—Ç–Ω—ã–π –≤–∑–≥–ª—è–¥ –≤ –∫–∞–º–µ—Ä—É.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, extreme close-up, young man face only filling frame, honest expression looking at camera, scarf barely visible at bottom, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 7, title: "–ü–æ–µ–∑–¥ –±–ª–∏–∂–µ", description: "–ü–æ–µ–∑–¥ –∫—Ä—É–ø–Ω–µ–µ, –Ω–∞–≥–Ω–µ—Ç–∞–µ–º –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.", dialogue: "–ù—É –Ω–µ —Å–Ω–∏–º–∞—Ç—å –∂–µ –º–Ω–µ, –∫–∞–∫ —è —á–∏—Ç–∞—é —Ä—ç–ø. –ò–ª–∏ –ø—Ä–∏—Ö–æ–∂—É –Ω–∞ –∏—Å–ø–æ–≤–µ–¥—å.", duration: "0:04", shotType: "medium", notes: "–ì–æ–ª–æ—Å –ñ–µ–Ω–∏ –∑–∞ –∫–∞–¥—Ä–æ–º. –ù–∞—Ä–∞—Å—Ç–∞—é—â–∏–π –∑–≤—É–∫.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, steam train approaching on railway tracks, larger than before, smoke billowing, sense of danger, perspective down rails, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 8, title: "–ñ–µ–Ω—è —Å–∏–¥–∏—Ç –Ω–∞ —Ä–µ–ª—å—Å–∞—Ö", description: "–ñ–µ–Ω—è, —Å—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω (–ø–æ –ø–æ—è—Å), —Å–∏–¥–∏—Ç –Ω–∞ —Ä–µ–ª—å—Å–∞—Ö —Å–≤—è–∑–∞–Ω–Ω—ã–π.", dialogue: "–ò–ª–∏ –∫–∞–∫ –ø—Ä–∏—Ö–æ–∂—É –Ω–∞ –∏—Å–ø–æ–≤–µ–¥—å –∏ —Ç–∞–º —á–∏—Ç–∞—é —Ä—ç–ø. –ò–ª–∏ –∫–∞–∫ —è –æ–±—Ä–∞—Ç–∏–ª—Å—è –∫ –≥–∞–¥–∞–ª–∫–µ, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–∞–≥–∞–¥–∞–ª–∞ –ø–æ–±–µ–¥—É.", duration: "0:06", shotType: "medium", notes: "–¢–µ–º–ø —Ä–µ—á–∏ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, young man sitting on railway tracks with bound hands, scarf around neck, speaking faster, bare trees, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 9, title: "–ñ–µ–Ω—è ‚Äî –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω, —Ç–µ–º–ø", description: "–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –ª–∏—Ü–∞ –ñ–µ–Ω–∏, –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç —Ç–µ–º–ø —Ä–µ—á–∏.", dialogue: "–ò–ª–∏ –∫–∞–∫ —è –ª–∏—á–Ω–æ—Å—Ç—å –∏ —Å–º–æ—Ç—Ä—é —Å–≤–æ—é –ø—Ä–æ—à–ª–æ–≥–æ–¥–Ω—é—é –∑–∞—è–≤–∫—É, –∫–æ—Ç–æ—Ä—É—é –∏ —Ç–æ–≥–¥–∞-—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω—è–ª. –ò–ª–∏ –∫–∞–∫ —è –ø–æ—é –∫–≤–Ω–æ–≤—Å–∫—É—é –ø–µ—Å–Ω—é, –∞ –Ω–∞ –Ω–µ–±–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∏–∑ —Ä–µ–∫–ª–∞–º—ã –º–µ–≥–∞—Ñ–æ–Ω–∞.", duration: "0:08", shotType: "close", notes: "–ë—ã—Å—Ç—Ä—ã–π —Ç–µ–º–ø!", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, young man face speaking rapidly, animated expression, slight panic, scarf visible, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 10, title: "–ü–æ–µ–∑–¥ ‚Äî –∫–æ–ª—ë—Å–∞", description: "–ü–æ–µ–∑–¥ –µ—â—ë –∫—Ä—É–ø–Ω–µ–µ, –≤–∏–¥–Ω—ã –∫–æ–ª—ë—Å–∞.", dialogue: "–ò–ª–∏ –≥–¥–µ —è –ø—Ä–æ–∫—É—Ä–æ—Ä —Å –∏—Ä–æ–∫–µ–∑–æ–º –∏ —Å –∫–∞–∫–æ–≥–æ-—Ç–æ —á—ë—Ä—Ç–∞ –æ—Å—É–∂–¥–∞—é –≤—Å—é –∏–≤–µ–Ω—Ç-–∏–Ω–¥—É—Å—Ç—Ä–∏—é.", duration: "0:04", shotType: "extreme-close", notes: "–ì–æ–ª–æ—Å –ñ–µ–Ω–∏ –∑–∞ –∫–∞–¥—Ä–æ–º. –ó–≤—É–∫ –º–µ—Ç–∞–ª–ª–∞.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, extreme close-up, train wheels on railway tracks, metal details, low angle, industrial power, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 11, title: "–ñ–µ–Ω—è ‚Äî –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ", description: "–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –ñ–µ–Ω–∏, –≥–æ–≤–æ—Ä–∏—Ç –±—ã—Å—Ç—Ä–µ–µ.", dialogue: "–ò–ª–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂—É—é –Ω–∞ –ø—Ä–æ—à–ª–æ–≥–æ–¥–Ω—é—é –∑–∞—è–≤–∫—É –¥—Ä—É–≥–æ–≥–æ –≤–µ–¥—É—â–µ–≥–æ –Ω–∞ —Ñ–æ–Ω–µ –ø—Ä–æ–µ–∫—Ç–æ—Ä–∞. –ò–ª–∏ –∫–∞–∫ —è –ø–∞—Ä–æ–¥–∏—Ä—É—é –ë–æ—Ä–∞—Ç–∞ –∏ –∑–∞–æ–¥–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—É –∫—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏—Ö –≤–µ–¥—É—â–∏—Ö.", duration: "0:07", shotType: "close", notes: "–ü–∞–Ω–∏–∫–∞ + —é–º–æ—Ä.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, young man speaking even faster, escalating panic with humor, wind blowing hair, lying on tracks, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 12, title: "–ü–æ–µ–∑–¥ –≥—É–¥–∏—Ç", description: "–ü–æ–µ–∑–¥ –Ω–∞—á–∏–Ω–∞–µ—Ç –≥—É–¥–µ—Ç—å, –∫—Ä—É–ø–Ω–æ –ª–æ–∫–æ–º–æ—Ç–∏–≤.", dialogue: "–ò–ª–∏ –≥–¥–µ —è –ø–æ–¥ –º—É–∑—ã–∫—É –∏–∑ –ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä –ø—Ä–æ—à—É —Å–µ–±—è –º–æ–ª–æ–¥–æ–≥–æ –Ω–µ –µ—Å—Ç—å –¥–æ—à–∏—Ä–∞–∫ –∏ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ù–∞—Å—Ç–µ–π –ú–æ—Ä–æ–∑–æ–≤–æ–π.", duration: "0:05", shotType: "medium", notes: "–ì–æ–ª–æ—Å –ñ–µ–Ω–∏ –∑–∞ –∫–∞–¥—Ä–æ–º. –ì—É–¥–æ–∫!", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, steam locomotive front view, horn blasting, approaching danger, dramatic angle, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 13, title: "–ñ–µ–Ω—è ‚Äî –ø–∞–Ω–∏–∫–∞ –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç", description: "–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –ñ–µ–Ω–∏, –ø–∞–Ω–∏–∫–∞ –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç.", dialogue: "–ò–ª–∏ –≥–¥–µ —è –∏–≥—Ä–∞—é –Ω–∞ —Ä–æ—è–ª–µ –¥–ª—è –ø–æ–∫–∞ –µ—â—ë –ø–æ–≤–µ—Ä–Ω—É–≤—à–∏—Ö—Å—è –∫–æ –º–Ω–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤. –ò–ª–∏ –º—É–ª—å—Ç–∏–∫–∏ –∫–∞–∫ –≤ –∫–∞–º–µ–¥–∏ –±–∞—Ç—Ç–ª–µ —Å —Ç–æ–ø–∞–º–∏ –∏–≤–µ–Ω—Ç–∞.", duration: "0:06", shotType: "close", notes: "–¢–µ–º–ø –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, young man face with rising panic, speaking intensely, determined expression, scarf visible, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 14, title: "–ü–æ–µ–∑–¥ ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω", description: "–ü–æ–µ–∑–¥ –≥—É–¥–∏—Ç –º–Ω–æ–≥–æ —Ä–∞–∑. –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∫–æ–ª—ë—Å/–≥—É–¥–∫–∞.", dialogue: "–ò–ª–∏ –∫–∞–∫ —è –≤–µ—Å—å —Ç–∞–∫–æ–π –Ω–∞—Å—Ç–æ—è—â–∏–π –Ω–µ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –∏–≥—Ä–∞—é –Ω–∞ –≥–∏—Ç–∞—Ä–µ –Ω–∞ —Ñ–æ–Ω–µ –Ω–µ–Ω–∞—Å—Ç–æ—è—â–∏—Ö —Å–≤–µ—á–µ–π‚Ä¶", duration: "0:04", shotType: "extreme-close", notes: "–ì–æ–ª–æ—Å –ñ–µ–Ω–∏ –∑–∞ –∫–∞–¥—Ä–æ–º. –ú–Ω–æ–≥–æ –≥—É–¥–∫–æ–≤!", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, extreme close-up, train wheels and horn detail, motion blur effect, metal textures, maximum tension, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 15, title: "–ñ–µ–Ω—è ‚Äî –ø–æ—á—Ç–∏ –∫—Ä–∏—á–∏—Ç", description: "–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –ñ–µ–Ω–∏, –ø–æ—á—Ç–∏ –∫—Ä–∏—á–∏—Ç, —Ç–µ–º–ø –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π.", dialogue: "–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å–µ–º—å—è–Ω–∏–Ω, —Å–ø–∞—Å–∞—Ç–µ–ª—å, –±–∞—Ä–º–µ–Ω, –∑–∞–ª–æ–∂–Ω–∏–∫, –≤–µ–¥—É—â–∏–π –Ω–æ–≤–æ—Å—Ç–µ–π, –ø–æ–∫–æ–π–Ω–∏–∫, —à–∏–∑–æ—Ñ—Ä–µ–Ω–∏–∫, –¥—Ä—É–≥ –≤–∏–¥–µ–æ–≥—Ä–∞—Ñ–∞, –ª—É—á–∏–∫, –≤ –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤‚Ä¶", duration: "0:08", shotType: "close", notes: "–ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è!", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, young man almost shouting, maximum intensity, desperate but comedic, climax moment, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 16, title: "–ü–æ–µ–∑–¥ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫—Ä—É–ø–Ω–æ", description: "–ü–æ–µ–∑–¥ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫—Ä—É–ø–Ω–æ, –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∫–∞–¥—Ä.", dialogue: "–°—Ç–µ–Ω–¥–∞–ø, –ø–æ–¥–∫–∞—Å—Ç, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è, –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫, –∏–Ω—Ç–µ—Ä–≤—å—é, –º–∞–Ω–∏—Ñ–µ—Å—Ç, –¥–µ–±–∞—Ç—ã, –æ–±–∑–æ—Ä, –ø–∞—Ä–æ–¥–∏—è, –æ–º–º–∞–∂, –ª–∞–π—Ñ, —à–æ—É—Ä–∏–ª, –¥—É—ç—Ç, –∫–∞–º–µ–æ‚Ä¶", duration: "0:06", shotType: "close", notes: "–ì–æ–ª–æ—Å –ñ–µ–Ω–∏ –∑–∞ –∫–∞–¥—Ä–æ–º. –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –Ω–∞ –ø–∏–∫–µ!", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, steam train front filling entire frame, imminent collision, peak tension, dramatic locomotive, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 17, title: "–ü–æ—è–≤–ª—è–µ—Ç—Å—è –ë—É–≥–∞–µ–Ω–∫–æ", description: "–ü–æ—è–≤–ª—è–µ—Ç—Å—è –ë—É–≥–∞–µ–Ω–∫–æ (–ì–µ—Ä–æ–π 2), —Å—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω. –ü–æ–¥–Ω–∏–º–∞–µ—Ç –ñ–µ–Ω—é, –æ—Ç—Ä—è—Ö–∏–≤–∞–µ—Ç.", dialogue: "–ñ–µ–Ω—å, –∞ —Ç—ã —á—ë —Ä–∞–∑–ª—ë–≥—Å—è? –¢—ã –∂ —Ö–æ—Ç–µ–ª –≤ –ø—Ä–µ–º–∏–∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –∏–º—è –ï–≤–≥–µ–Ω–∏—è –ö–∞—à–∞—Ä–Ω–æ–≥–æ –∫–∞–∂–¥—ã–π –Ω–∞ –Æ–≥–µ –∑–Ω–∞–ª.", duration: "0:06", shotType: "medium", notes: "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç!", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, second man entering frame helping first man up from railway tracks, rescue moment, frustrated gesture, bare trees, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 18, title: "–î–≤–æ–µ —É —Ä–µ–ª—å—Å–æ–≤", description: "–î–≤–æ–µ —Å—Ç–æ—è—Ç —É —Ä–µ–ª—å—Å–æ–≤, —Å—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω.", dialogue: "–¢–µ–±–µ –∂–µ —Å—Ç–∞—Ç—É—ç—Ç–∫–∞ –≤ –ø–µ—Ä–≤—ã–π –≥–æ–¥ —É—á–∞—Å—Ç–∏—è –Ω—É–∂–Ω–∞ –±—ã–ª–∞. –ê —Ç—ã —Ç—É—Ç –ª–µ–∂–∏—à—å, –µ—â—ë –∏ –≤ —ç—Ç–æ–º —Å—Ç—Ä–∞–Ω–Ω–æ–º –ø–ª–∞—Ç–∫–µ.", duration: "0:05", shotType: "medium", notes: "–ë—É–≥–∞–µ–Ω–∫–æ —Ä—É–≥–∞–µ—Ç—Å—è.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium two-shot, two men standing by railway tracks talking, one scolding the other, bare winter trees, comedic dialogue scene, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 19, title: "–ñ–µ–Ω—è —É–¥–∏–≤–ª—ë–Ω", description: "–ñ–µ–Ω—è, –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω. –£–¥–∏–≤–ª—ë–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.", dialogue: "–¢–∞–∫ –º—ã –≤–æ—Ç –∫–∞–∫ —Ä–∞–∑ —Å–µ–π—á–∞—Å –∑–∞—è–≤–∫—É —Å–Ω–∏–º–∞–µ–º!", duration: "0:03", shotType: "close", notes: "–ö–æ–º–µ–¥–∏–π–Ω—ã–π –º–æ–º–µ–Ω—Ç.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, young man with surprised expression, confused face, scarf around neck, comedic moment, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 20, title: "–ë—É–≥–∞–µ–Ω–∫–æ ‚Äî –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω", description: "–ë—É–≥–∞–µ–Ω–∫–æ, –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω.", dialogue: "–ö—Ç–æ –≤—ã, –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç. –≠—Ö —Ç—ã, –≤–µ—Å—å –≥–æ—Ä–æ–¥ –Ω–∞ —Ç–µ–±—è —Å–º–æ—Ç—Ä–µ–ª. –î–∞ –∏ –ø–æ–µ–∑–¥ —Ç–≤–æ–π —É—à—ë–ª.", duration: "0:05", shotType: "close", notes: "–†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, close-up, older man face with disappointed expression, shaking head, serious demeanor, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 21, title: "–ü–æ–µ–∑–¥ –ø—Ä–æ–µ–∑–∂–∞–µ—Ç –º–∏–º–æ", description: "–û–±—â–∏–π –ø–ª–∞–Ω. –ü–æ–µ–∑–¥ –ø—Ä–æ–µ–∑–∂–∞–µ—Ç –º–∏–º–æ. –î–≤–∞ –≥–µ—Ä–æ—è –Ω–∞ –ø–µ—Ä–µ–¥–Ω–µ–º –ø–ª–∞–Ω–µ.", dialogue: "", duration: "0:04", shotType: "wide", notes: "–ë–µ–∑ —Å–ª–æ–≤, —Ç–æ–ª—å–∫–æ –∑–≤—É–∫ –ø–æ–µ–∑–¥–∞.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, wide shot, steam train passing by in background, two men silhouettes in foreground watching, bare trees, dramatic sky, minimalist line art, 16:9 aspect ratio", image: "" },
                { id: 22, title: "–§–∏–Ω–∞–ª ‚Äî –≤–∑–≥–ª—è–¥ –≤ –∫–∞–º–µ—Ä—É", description: "–ñ–µ–Ω—è —Å–º–æ—Ç—Ä–∏—Ç –≤ –∫–∞–º–µ—Ä—É, —É–≤–µ—Ä–µ–Ω–Ω—ã–π –≤–∑–≥–ª—è–¥.", dialogue: "–≠—Ç–æ —Ç–≤–æ–π –ø–æ–µ–∑–¥ —É–∂–µ —É—à—ë–ª, –∞ –º–æ–π —Ç–æ–ª—å–∫–æ –Ω–∞–±–∏—Ä–∞–µ—Ç –æ–±–æ—Ä–æ—Ç—ã.", duration: "0:05", shotType: "medium", notes: "–≠–ø–∏—á–Ω—ã–π —Ñ–∏–Ω–∞–ª! –¢–∏—Ç—Ä—ã.", prompt: "Film storyboard sketch, inverted black and white, white lines on dark background, medium shot, young man looking confidently at camera, determined expression, second man beside him, triumphant finale, bare trees background, minimalist line art, 16:9 aspect ratio", image: "" }
            ];
            projectTitleEl.value = "–ó–∞—è–≤–∫–∞ –Ω–∞ Wedding Awards South ‚Äî –ï–≤–≥–µ–Ω–∏–π –ö–∞—à–∞—Ä–Ω—ã–π";
            saveToLocalStorage();
        }

        function renderAllScenes() {
            scenesContainer.innerHTML = '';
            scenes.forEach((scene, index) => renderScene(scene, index + 1));
            updateMeta();
        }

        function renderScene(scene, index) {
            const card = document.createElement('article');
            card.className = 'scene';
            card.dataset.id = scene.id;

            const shotTypes = {
                'wide': '–û–±—â–∏–π –ø–ª–∞–Ω',
                'medium': '–°—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω',
                'close': '–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω',
                'extreme-close': '–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω',
                'pov': '–û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞',
                'top-down': '–í–∏–¥ —Å–≤–µ—Ä—Ö—É'
            };

            card.innerHTML = `
                <!-- –®–ê–ü–ö–ê: –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–∞–π–º–∫–æ–¥ | –ü–ª–∞–Ω | –ì–µ—Ä–æ–∏ | –ö–Ω–æ–ø–∫–∏ -->
                <div class="scene-header-row">
                    <span class="scene-badge">–°—Ü–µ–Ω–∞ ${index}</span>
                    <input type="text" class="scene-title-input" value="${scene.title}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã...">
                    <div class="scene-meta-inline">
                        <div class="meta-field">
                            <label>‚è±</label>
                            <input type="text" class="duration-input" value="${scene.duration || '0:00'}" placeholder="0:00">
                        </div>
                        <div class="meta-field">
                            <label>üì∑</label>
                            <select class="shot-type-select">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                                ${Object.entries(shotTypes).map(([val, label]) =>
                `<option value="${val}" ${scene.shotType === val ? 'selected' : ''}>${label}</option>`
            ).join('')}
                            </select>
                        </div>
                        <div class="meta-field characters-inline">
                            <label>üë§</label>
                            <div class="characters-checkboxes">
                                ${characters.length === 0
                    ? '<span class="no-characters">–ù–µ—Ç –≥–µ—Ä–æ–µ–≤</span>'
                    : characters.map((char, i) => `
                                        <label class="character-checkbox">
                                            <input type="checkbox" value="${char.id}" ${(scene.charactersInScene || []).includes(char.id) ? 'checked' : ''}>
                                            <span>${char.name || '–ì–µ—Ä–æ–π ' + (i + 1)}</span>
                                        </label>
                                    `).join('')
                }
                            </div>
                        </div>
                    </div>
                    <div class="scene-actions">
                        <button class="scene-btn move-up" title="–í–≤–µ—Ä—Ö">‚¨ÜÔ∏è</button>
                        <button class="scene-btn move-down" title="–í–Ω–∏–∑">‚¨áÔ∏è</button>
                        <button class="scene-btn duplicate" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                        <button class="scene-btn delete" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                </div>

                <!-- –°–ï–†–ï–î–ò–ù–ê: –ö–∞—Ä—Ç–∏–Ω–∫–∞ (75%) + –û–ø–∏—Å–∞–Ω–∏–µ (25%) -->
                <div class="scene-middle-row">
                    <div class="scene-image-container">
                        <div class="scene-image-dropzone ${scene.image ? 'has-image' : ''}">
                            <input type="file" class="image-input hidden" accept="image/*">
                            <div class="dropzone-content" ${scene.image ? 'style="display:none"' : ''}>
                                <div class="dropzone-icon">üñºÔ∏è</div>
                                <div>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ</div>
                            </div>
                            <img class="scene-image" src="${scene.image || ''}" ${scene.image ? '' : 'style="display:none"'}>
                            <button class="remove-image" ${scene.image ? '' : 'style="display:none"'}>‚úï</button>
                        </div>
                    </div>
                    <div class="scene-description-side">
                        <div class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                        <textarea class="description-input" placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–∞–¥—Ä–µ...">${scene.description || ''}</textarea>
                    </div>
                </div>

                <!-- –ù–ò–ó: –î–∏–∞–ª–æ–≥ | –ó–∞–º–µ—Ç–∫–∏ -->
                <div class="scene-bottom-row">
                    <div class="field field-dialogue">
                        <div class="field-label">–î–∏–∞–ª–æ–≥–∏ / –ó–∞–∫–∞–¥—Ä–æ–≤—ã–π —Ç–µ–∫—Å—Ç</div>
                        <textarea class="dialogue-input dialogue" placeholder="–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–≤—É—á–∏—Ç...">${scene.dialogue || ''}</textarea>
                    </div>
                    <div class="field field-notes">
                        <div class="field-label">–ó–∞–º–µ—Ç–∫–∏</div>
                        <textarea class="notes-input" placeholder="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏...">${scene.notes || ''}</textarea>
                    </div>
                </div>
                <!-- –ü–†–û–ú–ü–¢ -->
                <div class="field prompt-field">
                    <div class="field-label">–ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>
                    <textarea class="prompt-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞...">${scene.prompt || ''}</textarea>
                </div>
            `;

            setupSceneEvents(card, scene);
            scenesContainer.appendChild(card);

            // –ê–≤—Ç–æ-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤—Å–µ—Ö textarea –ø–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            card.querySelectorAll('textarea').forEach(autoExpand);
        }

        function autoExpand(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
            textarea.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        }

        // Init App
        // Init App
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadFromLocalStorage();
            if (scenes.length === 0) {
                loadDefaultScenes();
            }
            renderAllScenes();
            renderCharacters();
        });

        function setupSceneEvents(card, scene) {
            const dropzone = card.querySelector('.scene-image-dropzone');
            const fileInput = card.querySelector('.image-input');
            const imageEl = card.querySelector('.scene-image');
            const removeBtn = card.querySelector('.remove-image');
            const dropzoneContent = card.querySelector('.dropzone-content');

            dropzone.addEventListener('click', (e) => {
                if (!e.target.closest('.remove-image')) fileInput.click();
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        scene.image = e.target.result;
                        imageEl.src = e.target.result;
                        imageEl.style.display = 'block';
                        removeBtn.style.display = 'flex';
                        dropzoneContent.style.display = 'none';
                        dropzone.classList.add('has-image');
                        saveToLocalStorage();
                    };
                    reader.readAsDataURL(file);
                }
            });

            dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.style.borderColor = 'var(--accent)'; });
            dropzone.addEventListener('dragleave', () => { dropzone.style.borderColor = ''; });
            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.style.borderColor = '';
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        scene.image = ev.target.result;
                        imageEl.src = ev.target.result;
                        imageEl.style.display = 'block';
                        removeBtn.style.display = 'flex';
                        dropzoneContent.style.display = 'none';
                        dropzone.classList.add('has-image');
                        saveToLocalStorage();
                    };
                    reader.readAsDataURL(file);
                }
            });

            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                scene.image = null;
                imageEl.src = '';
                imageEl.style.display = 'none';
                removeBtn.style.display = 'none';
                dropzoneContent.style.display = '';
                dropzone.classList.remove('has-image');
                saveToLocalStorage();
            });

            card.querySelector('.scene-title-input').addEventListener('input', (e) => { scene.title = e.target.value; saveToLocalStorage(); });
            card.querySelector('.duration-input').addEventListener('input', (e) => { scene.duration = e.target.value; saveToLocalStorage(); updateMeta(); });
            card.querySelector('.shot-type-select').addEventListener('change', (e) => { scene.shotType = e.target.value; saveToLocalStorage(); });
            card.querySelector('.description-input').addEventListener('input', (e) => { scene.description = e.target.value; saveToLocalStorage(); });
            card.querySelector('.dialogue-input').addEventListener('input', (e) => { scene.dialogue = e.target.value; saveToLocalStorage(); });
            card.querySelector('.notes-input').addEventListener('input', (e) => { scene.notes = e.target.value; saveToLocalStorage(); });
            card.querySelector('.prompt-input').addEventListener('input', (e) => { scene.prompt = e.target.value; saveToLocalStorage(); });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≥–µ—Ä–æ–µ–≤ –≤ —Å—Ü–µ–Ω–µ
            card.querySelectorAll('.character-checkbox input').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    if (!scene.charactersInScene) scene.charactersInScene = [];
                    const charId = parseInt(checkbox.value);
                    if (checkbox.checked) {
                        if (!scene.charactersInScene.includes(charId)) {
                            scene.charactersInScene.push(charId);
                        }
                    } else {
                        scene.charactersInScene = scene.charactersInScene.filter(id => id !== charId);
                    }
                    saveToLocalStorage();
                });
            });

            card.querySelector('.move-up').addEventListener('click', () => moveScene(scene.id, -1));
            card.querySelector('.move-down').addEventListener('click', () => moveScene(scene.id, 1));
            card.querySelector('.duplicate').addEventListener('click', () => duplicateScene(scene.id));
            card.querySelector('.delete').addEventListener('click', () => deleteScene(scene.id));
        }

        function addScene() {
            const scene = { id: Date.now(), title: '', description: '', dialogue: '', duration: '0:00', shotType: '', notes: '', prompt: '', charactersInScene: [], image: null };
            scenes.push(scene);
            renderAllScenes();
            saveToLocalStorage();
            showToast('–°—Ü–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
        }

        function moveScene(id, direction) {
            const index = scenes.findIndex(s => s.id === id);
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= scenes.length) return;
            [scenes[index], scenes[newIndex]] = [scenes[newIndex], scenes[index]];
            renderAllScenes();
            saveToLocalStorage();
        }

        function duplicateScene(id) {
            const scene = scenes.find(s => s.id === id);
            const index = scenes.findIndex(s => s.id === id);
            const newScene = { ...scene, id: Date.now(), title: scene.title + ' (–∫–æ–ø–∏—è)' };
            scenes.splice(index + 1, 0, newScene);
            renderAllScenes();
            saveToLocalStorage();
            showToast('–°—Ü–µ–Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∞');
        }

        function deleteScene(id) {
            scenes = scenes.filter(s => s.id !== id);
            renderAllScenes();
            saveToLocalStorage();
            showToast('–°—Ü–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞');
        }

        function updateMeta() {
            sceneCountEl.textContent = scenes.length;
            let totalSeconds = 0;
            scenes.forEach(s => {
                if (s.duration) {
                    const parts = s.duration.split(':');
                    if (parts.length === 2) {
                        totalSeconds += parseInt(parts[0] || 0) * 60 + parseInt(parts[1] || 0);
                    }
                }
            });
            const mins = Math.floor(totalSeconds / 60);
            const secs = totalSeconds % 60;
            totalDurationEl.value = `${mins}:${String(secs).padStart(2, '0')}`;
        }

        // ===== PERSISTENCE =====

        function saveToLocalStorage() {
            localStorage.setItem('storyboard_v2', JSON.stringify({ title: projectTitleEl.value, scenes, characters }));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('storyboard_v2');
            if (data) {
                const parsed = JSON.parse(data);
                projectTitleEl.value = parsed.title || '';
                scenes = parsed.scenes || [];
                characters = parsed.characters || [];
            }
        }

        function saveProject() {
            const data = { title: projectTitleEl.value, scenes, characters, exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${projectTitleEl.value || 'storyboard'}.json`;
            a.click();
            showToast('–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
        }

        function loadProject(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    projectTitleEl.value = data.title || '';
                    scenes = data.scenes || [];
                    characters = data.characters || [];
                    renderAllScenes();
                    renderCharacters();
                    saveToLocalStorage();
                    showToast('–ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
                } catch (err) {
                    showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
            };
            reader.readAsText(file);
        }

        function exportHTML() {
            // Export static HTML version
            let html = `<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><title>${projectTitleEl.value}</title><style>body{font-family:Arial,sans-serif;max-width:900px;margin:0 auto;padding:40px;background:#2c2c24;color:#f5f3ef}h1{text-align:center;margin-bottom:40px}.scene{margin-bottom:40px;background:#3d3d32;padding:24px;border-radius:12px}.scene-header{font-size:20px;font-weight:bold;margin-bottom:12px;color:#c45a32}.scene-image{max-width:100%;border-radius:8px;margin-bottom:16px}.field{margin-bottom:12px}.field-label{font-size:12px;color:#a8a498;text-transform:uppercase;margin-bottom:4px}.dialogue{background:#2c2c24;padding:12px;border-left:3px solid #c45a32;border-radius:0 8px 8px 0;font-style:italic}</style></head><body><h1>${projectTitleEl.value}</h1>`;
            scenes.forEach((s, i) => {
                html += `<div class="scene"><div class="scene-header">–°—Ü–µ–Ω–∞ ${i + 1}: ${s.title}</div>`;
                if (s.image) html += `<img class="scene-image" src="${s.image}">`;
                if (s.description) html += `<div class="field"><div class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ</div><div>${s.description}</div></div>`;
                if (s.dialogue) html += `<div class="field"><div class="field-label">–î–∏–∞–ª–æ–≥</div><div class="dialogue">${s.dialogue.replace(/\n/g, '<br>')}</div></div>`;
                if (s.duration) html += `<div class="field"><div class="field-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div><div>${s.duration}</div></div>`;
                if (s.notes) html += `<div class="field"><div class="field-label">–ó–∞–º–µ—Ç–∫–∏</div><div>${s.notes}</div></div>`;
                html += `</div>`;
            });
            html += `</body></html>`;
            const blob = new Blob([html], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${projectTitleEl.value || 'storyboard'}.html`;
            a.click();
            showToast('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω');
        }

        function printVersion() {
            const shotTypes = {
                'wide': '–û–±—â–∏–π –ø–ª–∞–Ω',
                'medium': '–°—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω',
                'close': '–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω',
                'extreme-close': '–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω',
                'pov': '–û—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞',
                'top-down': '–í–∏–¥ —Å–≤–µ—Ä—Ö—É'
            };

            let html = `<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><title>${projectTitleEl.value} ‚Äî PDF</title>
            <style>
                @page { size: A4 landscape; margin: 10mm; }
                * { box-sizing: border-box; margin: 0; padding: 0; }
                body { font-family: Arial, sans-serif; color: #333; font-size: 12px; }
                
                .page { 
                    page-break-after: always; 
                    width: 277mm; 
                    height: 190mm; 
                    padding: 10px;
                    display: flex;
                    flex-direction: column;
                }
                .page:last-child { page-break-after: auto; }
                
                /* –û–±–ª–æ–∂–∫–∞ */
                .cover { 
                    justify-content: center; 
                    align-items: center; 
                    text-align: center;
                }
                .cover h1 { font-size: 36px; margin-bottom: 20px; color: #c45a32; }
                .cover .meta { font-size: 16px; color: #666; }
                
                /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ü–µ–Ω—ã */
                .scene-card {
                    display: flex;
                    flex-direction: column;
                    height: 100%;
                    gap: 12px;
                    padding: 20px;
                    border: 3px solid #5a5a4e;
                    border-radius: 12px;
                    background: #f8f5f0;
                }
                
                /* –®–∞–ø–∫–∞: –Ω–æ–º–µ—Ä + –Ω–∞–∑–≤–∞–Ω–∏–µ + –º–µ—Ç–∞ */
                .scene-header {
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    padding-bottom: 12px;
                    border-bottom: 2px solid #d4cfc4;
                }
                .scene-badge {
                    background: #c45a32;
                    color: white;
                    font-size: 14px;
                    font-weight: bold;
                    padding: 8px 16px;
                    border-radius: 8px;
                    text-transform: uppercase;
                }
                .scene-title {
                    font-size: 20px;
                    font-weight: bold;
                    color: #c45a32;
                    flex: 1;
                }
                .scene-meta {
                    display: flex;
                    gap: 20px;
                    font-size: 12px;
                    color: #666;
                }
                
                /* –°–µ—Ä–µ–¥–∏–Ω–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ 60% + –æ–ø–∏—Å–∞–Ω–∏–µ 40% */
                .scene-middle {
                    display: flex;
                    gap: 16px;
                    flex: 1;
                    min-height: 0;
                }
                .scene-image-wrap {
                    flex: 0 0 60%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: #e8e2d8;
                    border: 2px dashed #d4cfc4;
                    border-radius: 10px;
                    overflow: hidden;
                }
                .scene-image {
                    max-width: 100%;
                    max-height: 100%;
                    object-fit: contain;
                }
                .scene-image-placeholder {
                    color: #999;
                    font-size: 14px;
                }
                .scene-description-side {
                    flex: 0 0 40%;
                    display: flex;
                    flex-direction: column;
                    background: #f0ebe3;
                    border-radius: 8px;
                    padding: 12px;
                }
                .scene-description-side .field-value {
                    font-size: 14px;
                    line-height: 1.5;
                    color: #3a3632;
                }
                
                /* –ù–∏–∑: –¥–∏–∞–ª–æ–≥ + –∑–∞–º–µ—Ç–∫–∏ */
                .scene-bottom {
                    display: flex;
                    gap: 16px;
                }
                .field-dialogue { flex: 2; }
                .field-notes { flex: 1; }
                
                .field-label {
                    font-size: 10px;
                    font-weight: bold;
                    text-transform: uppercase;
                    color: #6b6560;
                    margin-bottom: 6px;
                }
                .field-value {
                    font-size: 12px;
                    line-height: 1.4;
                }
                .dialogue-text {
                    background: #fffbf5;
                    padding: 12px 16px;
                    border-left: 4px solid #c45a32;
                    border-radius: 0 8px 8px 0;
                    font-style: italic;
                    font-size: 16px;
                    line-height: 1.5;
                    min-height: 80px;
                }
                
                /* –ü—Ä–æ–º–ø—Ç */
                .prompt-row {
                    font-size: 9px;
                    color: #999;
                    border-top: 1px dashed #d4cfc4;
                    padding-top: 8px;
                    margin-top: 8px;
                }

                /* –û–±–ª–æ–∂–∫–∞ - –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ */
                .cover-card {
                    border: 3px solid #5a5a4e;
                    border-radius: 16px;
                    background: #f8f5f0;
                    padding: 40px;
                    height: 100%;
                    display: flex;
                    flex-direction: column;
                }
                .cover-card h1 {
                    font-size: 42px;
                    color: #c45a32;
                    margin-bottom: 24px;
                    font-weight: 600;
                }
                .cover-meta {
                    display: flex;
                    gap: 32px;
                    font-size: 16px;
                    color: #6b6560;
                    margin-bottom: 32px;
                    align-items: center;
                }
                .cover-meta .dot {
                    width: 10px;
                    height: 10px;
                    background: #c45a32;
                    border-radius: 50%;
                    display: inline-block;
                    margin-right: 8px;
                }
                .cover-meta .duration-box {
                    background: #f0ebe3;
                    border: 1px solid #d4cfc4;
                    border-radius: 6px;
                    padding: 4px 12px;
                    font-weight: 500;
                }
                .characters-block {
                    background: #fffbf5;
                    border: 2px solid #d4cfc4;
                    border-radius: 12px;
                    padding: 20px;
                    flex: 1;
                }
                .characters-block h3 {
                    font-size: 14px;
                    color: #6b6560;
                    margin-bottom: 16px;
                    font-weight: 600;
                }
                .character-row {
                    background: #f0ebe3;
                    border: 1px solid #d4cfc4;
                    border-radius: 8px;
                    padding: 12px 16px;
                    margin-bottom: 12px;
                    display: flex;
                    gap: 16px;
                    align-items: flex-start;
                }
                .character-row:last-child {
                    margin-bottom: 0;
                }
                .character-label {
                    color: #c45a32;
                    font-weight: 600;
                    font-size: 12px;
                    min-width: 60px;
                }
                .character-name {
                    font-weight: 600;
                    color: #3a3632;
                    min-width: 120px;
                }
                .character-desc {
                    color: #6b6560;
                    font-size: 13px;
                    flex: 1;
                }
            </style></head><body>`;

            // Cover page - –∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ
            const charactersHtml = characters.length > 0
                ? characters.map((char, i) => `
                    <div class="character-row">
                        <span class="character-label">–ì–µ—Ä–æ–π ${i + 1}</span>
                        <span class="character-name">${char.name || '‚Äî'}</span>
                        <span class="character-desc">${char.description || ''}</span>
                    </div>
                `).join('')
                : '<div style="color: #999; font-style: italic;">–ì–µ—Ä–æ–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>';

            html += `<div class="page">
                <div class="cover-card">
                    <h1>${projectTitleEl.value}</h1>
                    <div class="cover-meta">
                        <span><span class="dot"></span>${scenes.length} —Å—Ü–µ–Ω</span>
                        <span><span class="dot"></span><span class="duration-box">${totalDurationEl.value}</span> —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂</span>
                        <span><span class="dot"></span>–°—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–∞–¥—Ä—ã</span>
                    </div>
                    <div class="characters-block">
                        <h3>üë§ –ì–µ—Ä–æ–∏</h3>
                        ${charactersHtml}
                    </div>
                </div>
            </div>`;

            // Scene pages
            scenes.forEach((s, i) => {
                html += `<div class="page">
                    <div class="scene-card">
                        <!-- –®–∞–ø–∫–∞ -->
                        <div class="scene-header">
                            <span class="scene-badge">–°—Ü–µ–Ω–∞ ${i + 1}</span>
                            <span class="scene-title">${s.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</span>
                            <div class="scene-meta">
                                <span>‚è± ${s.duration || '0:00'}</span>
                                <span>üì∑ ${shotTypes[s.shotType] || '‚Äî'}</span>
                            </div>
                        </div>
                        
                        <!-- –°–µ—Ä–µ–¥–∏–Ω–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ + –æ–ø–∏—Å–∞–Ω–∏–µ -->
                        <div class="scene-middle">
                            <div class="scene-image-wrap">
                                ${s.image
                        ? `<img class="scene-image" src="${s.image}">`
                        : `<span class="scene-image-placeholder">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</span>`
                    }
                            </div>
                            <div class="scene-description-side">
                                <div class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                                <div class="field-value">${s.description || '‚Äî'}</div>
                            </div>
                        </div>
                        
                        <!-- –ù–∏–∑: –¥–∏–∞–ª–æ–≥ + –∑–∞–º–µ—Ç–∫–∏ -->
                        <div class="scene-bottom">
                            <div class="field-dialogue">
                                <div class="field-label">–î–∏–∞–ª–æ–≥ / –ó–∞–∫–∞–¥—Ä–æ–≤—ã–π —Ç–µ–∫—Å—Ç</div>
                                <div class="dialogue-text">${s.dialogue ? s.dialogue.replace(/\n/g, '<br>') : '‚Äî'}</div>
                            </div>
                            <div class="field-notes">
                                <div class="field-label">–ó–∞–º–µ—Ç–∫–∏</div>
                                <div class="field-value">${s.notes || '‚Äî'}</div>
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–æ–º–ø—Ç -->
                        ${s.prompt ? `<div class="prompt-row"><strong>–ü—Ä–æ–º–ø—Ç:</strong> ${s.prompt}</div>` : ''}
                    </div>
                </div>`;
            });

            html += `</body></html>`;

            // Open in new window and trigger print
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            setTimeout(() => printWindow.print(), 500);
            showToast('–û—Ç–∫—Ä—ã—Ç–æ –æ–∫–Ω–æ PDF');
        }


        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.querySelector('.toast-icon').textContent = '‚úÖ';
            toast.querySelector('.toast-message').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>

</html>